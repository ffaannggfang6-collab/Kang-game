<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Thai Kang Online</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body{
      background:#0f172a;
      color:#fff;
      font-family:sans-serif;
      text-align:center;
      margin:0;
      padding:0;
    }
    .page{ display:none; padding-top:40px; }
    .page.active{ display:block; }
    input,button{
      padding:10px 18px;
      margin:8px;
      font-size:16px;
      border-radius:6px;
      border:none;
    }
    button{
      background:#facc15;
      cursor:pointer;
    }
    button:disabled{
      background:#555;
      cursor:not-allowed;
    }
    .room{
      display:block;
      width:220px;
      margin:10px auto;
    }
  </style>
</head>
<body>

<!-- ===== LOGIN ===== -->
<div id="login" class="page active">
  <h1>THAI KANG ONLINE</h1>
  <input id="username" placeholder="ชื่อผู้เล่น">
  <br>
  <button onclick="login()">เข้าเกม</button>
</div>

<!-- ===== LOBBY ===== -->
<div id="lobby" class="page">
  <h2>ล็อบบี้</h2>
  <p>เครดิต: <span id="credit">0</span></p>
  <div id="rooms"></div>
</div>

<script>
let socket;

/* ===== PAGE SWITCH ===== */
function show(id){
  document.querySelectorAll('.page').forEach(p=>{
    p.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

/* ===== LOGIN ===== */
function login(){
  const name = document.getElementById('username').value.trim();
  if(!name){
    alert('กรุณาใส่ชื่อ');
    return;
  }

  socket = io(window.location.origin);

  socket.on('login_success', (data)=>{
    document.getElementById('credit').innerText = data.user.credit;
    renderRooms(data.rooms);
    show('lobby');
  });

  socket.on('room_update', (rooms)=>{
    renderRooms(rooms);
  });

  socket.on('room_full', ()=>{
    alert('ห้องเต็มแล้ว (5 คน)');
  });

  socket.emit('login', name);
}

/* ===== ROOM LIST ===== */
function renderRooms(rooms){
  const roomDiv = document.getElementById('rooms');
  roomDiv.innerHTML = '';

  Object.keys(rooms).forEach(price=>{
    const count = rooms[price];
    const btn = document.createElement('button');
    btn.className = 'room';
    btn.innerText = `ห้อง ${price} เครดิต (${count}/5)`;
    btn.disabled = count >= 5;
    btn.onclick = ()=> joinRoom(price);
    roomDiv.appendChild(btn);
  });
}

/* ===== JOIN ===== */
function joinRoom(price){
  socket.emit('join_room', price);
  alert('เข้าห้อง ' + price + ' เครดิต');
}
</script>

</body>
</html>
